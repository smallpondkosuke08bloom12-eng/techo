<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ‰‹å¸³</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<style>
body{font-family:sans-serif;margin:0;padding:8px;background:#fafafa}
h1{font-size:18px;margin:4px 0}
#topbar button{margin:2px;padding:6px 10px}
#routines button{margin:2px;padding:6px 10px}
.year{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.monthView{display:grid;grid-template-columns:1fr;gap:8px}
.month{border:1px solid #ccc;padding:4px}
.month h2{font-size:14px;margin:2px 0}
.week{display:grid;grid-template-columns:repeat(7,1fr);font-size:10px;text-align:center}
.days{display:grid;grid-template-columns:repeat(7,1fr)}
.day{border:1px solid #ddd;min-height:24px;font-size:10px;text-align:center;cursor:pointer}
.work{background:#ffdede}
.life{background:#deebff}
hobby{background:#deffe4}
.none{background:#eee}
.today{outline:2px solid #000}
#todoView{font-size:12px}
.todoItem{border-bottom:1px solid #ccc;padding:4px 0}
.hidden{display:none}
</style>
</head>
<body>
<h1>ğŸ“˜ æ‰‹å¸³</h1>

<div id="topbar">
<button onclick="setView('year')">å¹´</button>
<button onclick="setView('month')">æœˆ</button>
<button onclick="setView('todo')">TODO</button>
</div>

<div id="routines">
<button onclick="setMode('work')">ä»•äº‹</button>
<button onclick="setMode('life')">ç§ç”¨</button>
<button onclick="setMode('hobby')">è¶£å‘³</button>
<button onclick="setMode('none')">ä½•ã‚‚ã—ãªã„</button>
</div>

<div id="calendar" class="year"></div>
<div id="todoView" class="hidden"></div>

<script>
function prevMonth(){
  currentMonth = (currentMonth + 11) % 12;
  render();
}

function nextMonth(){
  currentMonth = (currentMonth + 1) % 12;
  render();
}const calendar=document.getElementById('calendar');
const todoView=document.getElementById('todoView');
let currentView='year';
let viewDate = new Date(); // â† è¡¨ç¤ºä¸­ã®å¹´æœˆ
let currentMode='work';
const today=new Date().toISOString().slice(0,10);

function setMode(m){currentMode=m}
function setView(v){currentView=v;render()}

function save(key,val){localStorage.setItem(key,JSON.stringify(val))}
function load(key){return JSON.parse(localStorage.getItem(key)||'{}')}

const marks=load('marks');
const todos=load('todos');

function render(){
calendar.innerHTML='';
todoView.innerHTML='';
calendar.className=currentView==='year'?'year':'monthView';
calendar.classList.toggle('hidden',currentView==='todo');
todoView.classList.toggle('hidden',currentView!=='todo');


if(currentView==='todo'){
Object.keys(todos).sort().forEach(d=>{
const div=document.createElement('div');
div.className='todoItem';
div.textContent=`${d}ï¼š${todos[d]}`;
todoView.appendChild(div);
});
return;
}


if(currentView === 'month'){
  const header = document.createElement('div');
  header.style.display = 'flex';
  header.style.justifyContent = 'space-between';
  header.style.alignItems = 'center';
  header.style.margin = '4px 0';

  header.innerHTML = `
    <button onclick="prevMonth()">â—€</button>
    <strong>${y}å¹´ ${currentMonth + 1}æœˆ</strong>
    <button onclick="nextMonth()">â–¶</button>
  `;
  calendar.appendChild(header);
}const months=currentView==='year'?[...Array(12).keys()]:[currentMonth];
months.forEach(m=>{
const month=document.createElement('div');month.className='month';
month.innerHTML=`<h2>${m+1}æœˆ</h2>`;
const week=document.createElement('div');week.className='week';
['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(w=>week.innerHTML+=`<div>${w}</div>`);
month.appendChild(week);
const days=document.createElement('div');days.className='days';
const first=new Date(y,m,1).getDay();
for(let i=0;i<first;i++)days.innerHTML+='<div></div>';
const last=new Date(y,m+1,0).getDate();
for(let d=1;d<=last;d++){
const date=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
const div=document.createElement('div');div.className='day';
if(marks[date])div.classList.add(marks[date]);
if(date===today)div.classList.add('today');
div.textContent=d;
div.onclick=()=>{
marks[date]=currentMode;save('marks',marks);
const t=prompt('TODOï¼ˆç©ºã§OKï¼‰',todos[date]||'');
if(t!==null){t?todos[date]=t:delete todos[date];save('todos',todos)}
render();
};
days.appendChild(div);
}
month.appendChild(days);
calendar.appendChild(month);
});
}

if('serviceWorker'in navigator){navigator.serviceWorker.register('sw.js')}
render();
</script>
</body>
</html>
