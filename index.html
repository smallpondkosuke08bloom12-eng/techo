<!DOCTYPE html><html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>手帳PWA</title>
<style>
body{margin:0;font-family:sans-serif;background:#f5f2eb}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #ccc;padding:10px}
#today{font-size:18px;font-weight:bold;margin-bottom:6px}
#nav button{margin:2px;padding:6px 10px}
#nav .on{background:#333;color:#fff}
main{padding:8px}
.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}
.cell{min-height:56px;border:1px solid #ccc;background:#fff;text-align:center;font-size:14px}
.today{outline:3px solid #000}
.work{background:#cfe8ff;color:#004b87}
.lesson{background:#dff5d8;color:#1f6b2d}
.meet{background:#ffd6df;color:#8a0030}
.hobby{background:#fff3c4;color:#7a5a00}
.todo{font-size:11px}
</style>
</head>
<body>
<header>
  <div id="today"></div>
  <div id="nav">
    <button onclick="setView('week')">週</button>
    <button onclick="setView('month')">月</button>
    <button onclick="setView('year')">年</button>
    <button onclick="setView('todo')">TODO</button>
  </div>
</header>
<main id="app"></main>
<script>
var view='week'
var marks=JSON.parse(localStorage.getItem('marks')||'{}')
var todos=JSON.parse(localStorage.getItem('todos')||'{}')function now(){return new Date()} function key(d){return d.toISOString().slice(0,10)} function fmt(d){return d.getFullYear()+'年'+(d.getMonth()+1)+'月'+d.getDate()+'日（'+'日月火水木金土'[d.getDay()]+'）'}

function setView(v){view=v;render()}

function render(){ document.getElementById('today').textContent=fmt(now())+' 今日' document.querySelectorAll('#nav button').forEach(b=>b.classList.remove('on')) document.querySelector('#nav button:nth-child('+({week:1,month:2,year:3,todo:4}[view])+')').classList.add('on') var a=document.getElementById('app');a.innerHTML='' if(view==='week')week(a) if(view==='month')month(a) if(view==='year')year(a) if(view==='todo')todo(a) }

function week(a){ var t=now();var s=new Date(t);s.setDate(t.getDate()-t.getDay()) var g=document.createElement('div');g.className='grid' for(var i=0;i<7;i++){ var d=new Date(s);d.setDate(s.getDate()+i) var c=document.createElement('div');c.className='cell' var k=key(d) if(k===key(now()))c.classList.add('today') if(marks[k])c.classList.add(marks[k]) c.innerHTML=d.getDate()+(todos[k]?'<div class="todo">'+todos[k]+'</div>':'') c.ontouchstart=function(e){this.t=setTimeout(()=>edit(k),600)} c.ontouchend=function(){clearTimeout(this.t)} g.appendChild(c) } a.appendChild(g) }

function month(a){ var d=now();var y=d.getFullYear();var m=d.getMonth() var h=document.createElement('h3');h.textContent=y+'年 '+(m+1)+'月';a.appendChild(h) var g=document.createElement('div');g.className='grid' var f=new Date(y,m,1).getDay();for(var i=0;i<f;i++)g.appendChild(document.createElement('div')) var l=new Date(y,m+1,0).getDate() for(var i=1;i<=l;i++){ var dd=new Date(y,m,i);var k=key(dd) var c=document.createElement('div');c.className='cell';c.textContent=i if(marks[k])c.classList.add(marks[k]) c.onclick=function(){toggle(k)} c.ontouchstart=function(){this.t=setTimeout(()=>edit(k),600)} c.ontouchend=function(){clearTimeout(this.t)} g.appendChild(c) } a.appendChild(g) }

function year(a){ var y=now().getFullYear() for(var m=0;m<12;m++){ var h=document.createElement('h4');h.textContent=(m+1)+'月';a.appendChild(h) var g=document.createElement('div');g.className='grid' var l=new Date(y,m+1,0).getDate() for(var i=1;i<=l;i++){ var k=key(new Date(y,m,i)) var c=document.createElement('div');c.className='cell';c.textContent=i if(marks[k])c.classList.add(marks[k]) g.appendChild(c) } a.appendChild(g) } }

function todo(a){ Object.keys(todos).sort().forEach(k=>{ var d=document.createElement('div') d.textContent=k+' '+todos[k] d.onclick=function(){edit(k)} a.appendChild(d) }) }

function toggle(k){ if(!marks[k])marks[k]='work' else delete marks[k] localStorage.setItem('marks',JSON.stringify(marks));render() }

function edit(k){ var t=prompt('予定',todos[k]||'') if(t===null)return if(t==='')delete todos[k]; else todos[k]=t localStorage.setItem('todos',JSON.stringify(todos));render() }

render() </script>

</body>
</html>
