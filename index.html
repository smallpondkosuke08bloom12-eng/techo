<!DOCTYPE html><html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ‰‹å¸³PWA</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<style>
/* ===== ãƒ™ãƒ¼ã‚¹ï¼ˆæ‰‹å¸³é¢¨ãƒ»å¤§ãã‚ï¼‰ ===== */
body{
  font-family:"Hiragino Mincho ProN","Yu Mincho",serif;
  margin:0;
  padding:12px;
  background:#f5f2ed;
  font-size:18px;
}h1{ font-size:24px; margin:8px 0 12px; }

/* ===== ãƒœã‚¿ãƒ³ ===== */ #topbar, #routines{ display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px; }

#topbar button, #routines button{ padding:12px 18px; font-size:16px; border-radius:12px; border:1px solid #bbb; background:#fffdf8; }

#topbar button{font-weight:600}

/* ===== ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ===== */ .year{ display:grid; grid-template-columns:1fr; gap:16px; }

.monthView{ display:grid; grid-template-columns:1fr; gap:16px; }

.month{ border:1px solid #c9c3b8; padding:12px; border-radius:16px; background:#fffdf8; }

.month h2{ font-size:20px; margin:6px 0 10px; text-align:center; }

/* ===== æ›œæ—¥ãƒ»æ—¥ä»˜ ===== */ .week{ display:grid; grid-template-columns:repeat(7,1fr); font-size:14px; text-align:center; margin-bottom:6px; }

.days{ display:grid; grid-template-columns:repeat(7,1fr); gap:6px; }

.day{ border:1px solid #ddd; min-height:56px; font-size:18px; display:flex; align-items:center; justify-content:center; border-radius:10px; cursor:pointer; background:#fff; }

/* ===== çŠ¶æ…‹è‰²ï¼ˆã‚„ã‚ã‚‰ã‹ï¼‰ ===== */ .work{background:#cfe9f6;color:#1e5a7a} .lesson{background:#dff4d8;color:#2f6b3c} .hobby{background:#fff2b3;color:#7a6500} .meeting{background:#f6c7d0;color:#7a1e2e}

.today{ outline:3px dashed #444; }

/* ===== TODO ===== */ #todoView{font-size:18px}

.todoItem{ border-bottom:1px dashed #aaa; padding:10px 6px; }

.hidden{display:none} </style>

</head>
<body>
<h1>ğŸ“˜ æ‰‹å¸³</h1><div id="topbar">
  <button onclick="setView('year')">å¹´</button>
  <button onclick="setView('month')">æœˆ</button>
  <button onclick="setView('todo')">TODO</button>
</div><div id="routines">
  <button class="workBtn" onclick="setMode('work')">ä»•äº‹</button>
  <button class="lessonBtn" onclick="setMode('lesson')">ç¿’ã„äº‹</button>
  <button class="meetingBtn" onclick="setMode('meeting')">ä¼šåˆ</button>
  <button class="hobbyBtn" onclick="setMode('hobby')">è¶£å‘³</button>
</div><div id="calendar" class="year"></div>
<div id="todoView" class="hidden">
  <button onclick="addTodo()">ï¼‹äºˆå®šã‚’è¿½åŠ </button>
</div><script>
// ===== çŠ¶æ…‹ =====
const calendar = document.getElementById('calendar');
const todoView = document.getElementById('todoView');

let currentView = 'year';
let viewDate = new Date();   // è¡¨ç¤ºä¸­ã®å¹´æœˆï¼ˆå”¯ä¸€ã®åŸºæº–ï¼‰
let currentMode = 'work'; // work / lesson / meeting / hobby
const today = new Date().toISOString().slice(0,10);

// ===== åŸºæœ¬æ“ä½œ =====
function setMode(m){ currentMode = m; }
function setView(v){ currentView = v; render(); }

function prevMonth(){ viewDate.setMonth(viewDate.getMonth() - 1); render(); }
function nextMonth(){ viewDate.setMonth(viewDate.getMonth() + 1); render(); }

// ===== ä¿å­˜ =====
function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
function load(key){ return JSON.parse(localStorage.getItem(key) || '{}'); }

const marks = load('marks');
const todos = load('todos');

// ===== æç”» =====
function addTodo(){
  const d = prompt('æ—¥ä»˜ï¼ˆYYYY-MM-DDï¼‰');
  if(!d) return;
  const t = prompt('å†…å®¹');
  if(!t) return;
  todos[d] = t;
  save('todos', todos);
  render();
}

function render(){
  calendar.innerHTML = '';
  todoView.innerHTML = '';

  calendar.className = currentView === 'year' ? 'year' : 'monthView';
  calendar.classList.toggle('hidden', currentView === 'todo');
  todoView.classList.toggle('hidden', currentView !== 'todo');

  const y = viewDate.getFullYear();
  const m0 = viewDate.getMonth(); // 0-11

  // TODOãƒ“ãƒ¥ãƒ¼
  if(currentView === 'todo'){
    Object.keys(todos).sort().forEach(d => {
      const div = document.createElement('div');
      div.className = 'todoItem';
      div.textContent = `${d}ï¼š${todos[d]}`;
      todoView.appendChild(div);
    });
    return;
  }

  // æœˆãƒ˜ãƒƒãƒ€ãƒ¼
  if(currentView === 'month'){
    const header = document.createElement('div');
    header.style.display = 'flex';
    header.style.justifyContent = 'space-between';
    header.style.alignItems = 'center';
    header.style.margin = '4px 0';
    header.innerHTML = `
      <button onclick="prevMonth()">â—€</button>
      <strong>${y}å¹´ ${m0 + 1}æœˆ</strong>
      <button onclick="nextMonth()">â–¶</button>
    `;
    calendar.appendChild(header);
  }

  const months = currentView === 'year'
    ? [...Array(12).keys()]
    : [m0];

  months.forEach(m => {
    const month = document.createElement('div');
    month.className = 'month';
    month.innerHTML = `<h2>${m + 1}æœˆ</h2>`;

    const week = document.createElement('div');
    week.className = 'week';
    ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(w => {
      week.innerHTML += `<div>${w}</div>`;
    });
    month.appendChild(week);

    const days = document.createElement('div');
    days.className = 'days';

    const first = new Date(y, m, 1).getDay();
    for(let i=0;i<first;i++) days.innerHTML += '<div></div>';

    const last = new Date(y, m+1, 0).getDate();
    for(let d=1; d<=last; d++){
      const date = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const div = document.createElement('div');
      div.className = 'day';
      if(marks[date]) div.classList.add(marks[date]);
      if(date === today) div.classList.add('today');
      div.textContent = d;
      div.onclick = () => {
        // 1ã‚¿ãƒƒãƒ—ï¼šãƒãƒ¼ã‚­ãƒ³ã‚°åˆ‡æ›¿ï¼ˆç¢ºèªãªã—ï¼‰
        if(marks[date] === currentMode){
          delete marks[date];
        }else{
          marks[date] = currentMode;
        }
        save('marks', marks);
        render();
      };

      div.ondblclick = () => {
        // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ï¼šãƒãƒ¼ã‚­ãƒ³ã‚°è§£é™¤
        delete marks[date];
        save('marks', marks);
        render();
      };
      days.appendChild(div);
    }

    month.appendChild(days);
    calendar.appendChild(month);
  });
}

if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js'); }
render();
</script></body>
</html>
