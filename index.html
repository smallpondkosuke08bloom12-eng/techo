<!DOCTYPE html><html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ‰‹å¸³</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<style>
body{font-family:"Hiragino Maru Gothic ProN",sans-serif;margin:0;padding:12px;background:#fdfcf8}
h1{font-size:22px;margin:6px 0}
#topbar button,#routines button,#addTodoBtn{margin:4px;padding:10px 14px;font-size:16px;border-radius:10px;border:1px solid #ccc;background:#fff}
#routines button.active{border-width:2px}
.year{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.monthView,.weekView{display:grid;grid-template-columns:1fr;gap:12px}
.month,.week{border:1px solid #ddd;padding:8px;border-radius:12px;background:#fff}
.month h2,.week h2{font-size:16px;margin:4px 0;text-align:center}
.weekHeader{display:grid;grid-template-columns:repeat(7,1fr);font-size:13px;text-align:center;font-weight:bold}
.weekDays{display:grid;grid-template-columns:repeat(7,1fr)}
.day,.weekDay{border:1px solid #eee;min-height:50px;font-size:14px;text-align:center;cursor:pointer;border-radius:6px;padding:4px}
.work{background:#d8ecff;color:#1b4f8a}
.lesson{background:#e3f6e8;color:#1f6b3a}
.meeting{background:#ffe1e6;color:#8a1b32}
.hobby{background:#fff4cc;color:#8a6b1b}
.today{outline:3px solid #555}
.todoText{font-size:12px;margin-top:4px}
#todoView{font-size:15px}
.todoItem{border-bottom:1px dashed #ccc;padding:8px 0}
.hidden{display:none}
</style>
</head>
<body>
<h1>ğŸ“˜ æ‰‹å¸³</h1><div id="topbar">
<button onclick="setView('year')">å¹´</button>
<button onclick="setView('month')">æœˆ</button>
<button onclick="setView('week')">é€±</button>
<button onclick="setView('todo')">TODO</button>
</div><div id="routines">
<button data-mode="work" onclick="setMode('work')">ä»•äº‹</button>
<button data-mode="lesson" onclick="setMode('lesson')">ç¿’ã„äº‹</button>
<button data-mode="meeting" onclick="setMode('meeting')">ä¼šåˆ</button>
<button data-mode="hobby" onclick="setMode('hobby')">è¶£å‘³</button>
</div><div id="calendar" class="year"></div>
<div id="todoView" class="hidden">
<button id="addTodoBtn" onclick="addTodo()">ï¼‹äºˆå®šã‚’ä½œæˆ</button>
<div id="todoList"></div>
</div><script>
const calendar=document.getElementById('calendar');
const todoView=document.getElementById('todoView');
const todoList=document.getElementById('todoList');
let currentView='year';
let viewDate=new Date();
let currentMode='work';
const todayStr=new Date().toISOString().slice(0,10);

function setMode(m){
 currentMode=m;
 document.querySelectorAll('#routines button').forEach(b=>{
  b.classList.toggle('active',b.dataset.mode===m);
  b.style.borderColor=b.dataset.mode===m?getColor(m):'#ccc';
 });
}

function getColor(m){
 return {work:'#1b4f8a',lesson:'#1f6b3a',meeting:'#8a1b32',hobby:'#8a6b1b'}[m];
}

function setView(v){currentView=v;render()}

function save(key,val){localStorage.setItem(key,JSON.stringify(val))}
function load(key){return JSON.parse(localStorage.getItem(key)||'{}')}

const marks=load('marks');
const todos=load('todos');

function addTodo(){
 const d=prompt('æ—¥ä»˜ï¼ˆYYYY-MM-DDï¼‰');
 if(!d)return;
 const t=prompt('äºˆå®šå†…å®¹');
 if(!t)return;
 todos[d]=t;save('todos',todos);render();
}

function startOfWeek(date){
 const d=new Date(date);
 const day=d.getDay();
 d.setDate(d.getDate()-day);
 return d;
}

function render(){
calendar.innerHTML='';
todoList.innerHTML='';
calendar.className=currentView==='year'?'year':currentView==='week'?'weekView':'monthView';
calendar.classList.toggle('hidden',currentView==='todo');
todoView.classList.toggle('hidden',currentView!=='todo');

if(currentView==='todo'){
 Object.keys(todos).sort().forEach(d=>{
  const div=document.createElement('div');
  div.className='todoItem';
  div.textContent=`${d}ï¼š${todos[d]}`;
  todoList.appendChild(div);
 });
 return;
}

const y=viewDate.getFullYear();
const m=viewDate.getMonth();

if(currentView==='week'){
 const start=startOfWeek(viewDate);
 const week=document.createElement('div');week.className='week';
 week.innerHTML=`<h2>${start.getMonth()+1}æœˆ ç¬¬${Math.ceil(start.getDate()/7)}é€±</h2>`;
 const header=document.createElement('div');header.className='weekHeader';
 ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(w=>header.innerHTML+=`<div>${w}</div>`);
 week.appendChild(header);
 const days=document.createElement('div');days.className='weekDays';
 for(let i=0;i<7;i++){
  const d=new Date(start);d.setDate(start.getDate()+i);
  const dateStr=d.toISOString().slice(0,10);
  const cell=document.createElement('div');cell.className='weekDay';
  if(marks[dateStr])cell.classList.add(marks[dateStr]);
  if(dateStr===todayStr)cell.classList.add('today');
  cell.innerHTML=`<strong>${d.getDate()}</strong>`;
  if(todos[dateStr]){
   const t=document.createElement('div');t.className='todoText';t.textContent=todos[dateStr];
   cell.appendChild(t);
  }
  cell.onclick=()=>{
   if(marks[dateStr]===currentMode)delete marks[dateStr];
   else marks[dateStr]=currentMode;
   save('marks',marks);render();
  };
  days.appendChild(cell);
 }
 week.appendChild(days);
 calendar.appendChild(week);
 return;
}

const months=currentView==='year'?[...Array(12).keys()]:[m];
months.forEach(mm=>{
 const month=document.createElement('div');month.className='month';
 month.innerHTML=`<h2>${mm+1}æœˆ</h2>`;
 const week=document.createElement('div');week.className='weekHeader';
 ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(w=>week.innerHTML+=`<div>${w}</div>`);
 month.appendChild(week);
 const days=document.createElement('div');days.className='weekDays';
 const first=new Date(y,mm,1).getDay();
 for(let i=0;i<first;i++)days.innerHTML+='<div></div>';
 const last=new Date(y,mm+1,0).getDate();
 for(let d=1;d<=last;d++){
  const dateStr=`${y}-${String(mm+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
  const div=document.createElement('div');div.className='day';
  if(marks[dateStr])div.classList.add(marks[dateStr]);
  if(dateStr===todayStr)div.classList.add('today');
  div.textContent=d;
  div.onclick=()=>{
   if(marks[dateStr]===currentMode)delete marks[dateStr];
   else marks[dateStr]=currentMode;
   save('marks',marks);render();
  };
  days.appendChild(div);
 }
 month.appendChild(days);
 calendar.appendChild(month);
});
}

setMode('work');
render();
</script></body>
</html>
    
