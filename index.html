<!DOCTYPE html><html lang="ja">
<head>
<meta charset="UTF-8">
<title>ÊâãÂ∏≥</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<style>
body{font-family:"Hiragino Maru Gothic ProN",sans-serif;margin:0;padding:12px;background:#fdfcf8}
h1{font-size:22px;margin:6px 0}
#topbar button,#routines button,#addTodoBtn{margin:4px;padding:10px 14px;font-size:16px;border-radius:10px;border:1px solid #ccc;background:#fff}
#routines button.active{border-width:2px}
.year{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.monthScroll{display:flex;overflow-x:auto;gap:12px;padding-bottom:8px}
.month{min-width:280px;border:1px solid #ddd;padding:8px;border-radius:12px;background:#fff}
.month h2{font-size:16px;margin:4px 0;text-align:center}
.weekHeader{display:grid;grid-template-columns:repeat(7,1fr);font-size:13px;text-align:center;font-weight:bold}
.weekDays{display:grid;grid-template-columns:repeat(7,1fr)}
.day{border:1px solid #eee;min-height:44px;font-size:14px;text-align:center;cursor:pointer;border-radius:6px;padding:4px}
.work{background:#d8ecff;color:#1b4f8a}
.lesson{background:#e3f6e8;color:#1f6b3a}
.meeting{background:#ffe1e6;color:#8a1b32}
.hobby{background:#fff4cc;color:#8a6b1b}
.today{outline:3px solid #555}
#todoView{font-size:15px}
.todoItem{border-bottom:1px dashed #ccc;padding:8px 0}
.todoItem button{margin-left:6px}
.hidden{display:none}
.selectGrid{display:grid;grid-template-columns:repeat(6,1fr);gap:4px;margin:8px 0}
.selectGrid button{padding:6px;border-radius:6px;border:1px solid #ccc;background:#fff}
</style>
</head>
<body>
<h1>üìò ÊâãÂ∏≥</h1><div id="topbar">
<button onclick="setView('year')">Âπ¥</button>
<button onclick="setView('month')">Êúà</button>
<button onclick="setView('todo')">TODO</button>
</div><div id="routines">
<button data-mode="work" onclick="setMode('work')">‰ªï‰∫ã</button>
<button data-mode="lesson" onclick="setMode('lesson')">Áøí„ÅÑ‰∫ã</button>
<button data-mode="meeting" onclick="setMode('meeting')">‰ºöÂêà</button>
<button data-mode="hobby" onclick="setMode('hobby')">Ë∂£Âë≥</button>
</div><div id="calendar"></div>
<div id="todoView" class="hidden"></div><script>
const calendar=document.getElementById('calendar');
const todoView=document.getElementById('todoView');
let currentView='month';
let viewDate=new Date();
let currentMode='work';
let selectedDate=null;
const todayStr=new Date().toISOString().slice(0,10);

function setMode(m){currentMode=m;document.querySelectorAll('#routines button').forEach(b=>{b.classList.toggle('active',b.dataset.mode===m)})}
function setView(v){currentView=v;render()}
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
function load(k){return JSON.parse(localStorage.getItem(k)||'{}')}

const marks=load('marks');
let todos=load('todos');

function render(){
 calendar.innerHTML='';
 todoView.innerHTML='';
 calendar.classList.toggle('hidden',currentView==='todo');
 todoView.classList.toggle('hidden',currentView!=='todo');
 const y=viewDate.getFullYear();

 if(currentView==='month'){
  const wrap=document.createElement('div');wrap.className='monthScroll';
  for(let offset=-6;offset<=5;offset++){
   const d=new Date(y,viewDate.getMonth()+offset,1);
   wrap.appendChild(renderMonth(d));
  }
  calendar.appendChild(wrap);
  return;
 }

 if(currentView==='todo'){
  renderTodo();
 }
}

function renderMonth(dateObj){
 const y=dateObj.getFullYear();
 const m=dateObj.getMonth();
 const month=document.createElement('div');month.className='month';
 month.innerHTML=`<h2>${y}Âπ¥ ${m+1}Êúà</h2>`;
 const header=document.createElement('div');header.className='weekHeader';
 ['Êó•','Êúà','ÁÅ´','Ê∞¥','Êú®','Èáë','Âúü'].forEach(w=>header.innerHTML+=`<div>${w}</div>`);
 month.appendChild(header);
 const days=document.createElement('div');days.className='weekDays';
 const first=new Date(y,m,1).getDay();
 for(let i=0;i<first;i++)days.innerHTML+='<div></div>';
 const last=new Date(y,m+1,0).getDate();
 for(let d=1;d<=last;d++){
  const dateStr=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
  const div=document.createElement('div');div.className='day';
  if(marks[dateStr])div.classList.add(marks[dateStr]);
  if(dateStr===todayStr)div.classList.add('today');
  div.textContent=d;
  let pressTimer;
  div.onmousedown=()=>pressTimer=setTimeout(()=>{selectedDate=dateStr;setView('todo')},500);
  div.onmouseup=()=>clearTimeout(pressTimer);
  div.onclick=()=>{
   if(marks[dateStr]===currentMode)delete marks[dateStr];
   else marks[dateStr]=currentMode;
   save('marks',marks);render();
  };
  days.appendChild(div);
 }
 month.appendChild(days);
 return month;
}

function renderTodo(){
 const title=document.createElement('h2');title.textContent='‰∫àÂÆöÁÆ°ÁêÜ';
 todoView.appendChild(title);

 const dateInfo=document.createElement('div');dateInfo.textContent=selectedDate?`ÈÅ∏ÊäûÊó•Ôºö${selectedDate}`:'Êó•‰ªò„ÇíÈÅ∏Êäû';
 todoView.appendChild(dateInfo);

 const monthSel=document.createElement('div');monthSel.className='selectGrid';
 for(let m=1;m<=12;m++){
  const b=document.createElement('button');b.textContent=m+'Êúà';
  b.onclick=()=>{selectedDate=`${viewDate.getFullYear()}-${String(m).padStart(2,'0')}-01`;renderTodo()};
  monthSel.appendChild(b);
 }
 todoView.appendChild(monthSel);

 const daySel=document.createElement('div');daySel.className='selectGrid';
 for(let d=1;d<=31;d++){
  const b=document.createElement('button');b.textContent=d;
  b.onclick=()=>{if(selectedDate){const p=selectedDate.split('-');selectedDate=`${p[0]}-${p[1]}-${String(d).padStart(2,'0')}`;renderTodo()}};
  daySel.appendChild(b);
 }
 todoView.appendChild(daySel);

 if(selectedDate){
  const input=document.createElement('input');input.placeholder='‰∫àÂÆöÂÜÖÂÆπ';input.style.width='100%';
  const saveBtn=document.createElement('button');saveBtn.textContent='‰øùÂ≠ò';
  saveBtn.onclick=()=>{todos[selectedDate]=input.value;save('todos',todos);renderTodo()};
  todoView.appendChild(input);todoView.appendChild(saveBtn);
 }

 Object.keys(todos).sort().forEach(d=>{
  const div=document.createElement('div');div.className='todoItem';
  div.textContent=`${d}Ôºö${todos[d]}`;
  const del=document.createElement('button');del.textContent='ÂâäÈô§';
  del.onclick=()=>{delete todos[d];save('todos',todos);renderTodo()};
  div.appendChild(del);
  todoView.appendChild(div);
 });
}

setMode('work');
render();
</script></body>
</html>
