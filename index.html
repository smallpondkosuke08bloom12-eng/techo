<!DOCTYPE html><html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ‰‹å¸³PWA</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<style>
/* ===== ãƒ™ãƒ¼ã‚¹ ===== */
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  margin:0;
  padding:8px;
  background:#fafafa;
  font-size:14px;
}h1{ font-size:20px; margin:6px 0 8px; }

/* ===== ãƒœã‚¿ãƒ³ ===== */ #topbar, #routines{ display:flex; flex-wrap:wrap; gap:6px; margin-bottom:8px; }

#topbar button, #routines button{ padding:10px 14px; font-size:14px; border-radius:8px; border:1px solid #ccc; background:#fff; }

#topbar button{font-weight:600}

/* ===== ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ===== */ .year{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px; }

.monthView{ display:grid; grid-template-columns:1fr; gap:12px; }

.month{ border:1px solid #ccc; padding:8px; border-radius:10px; background:#fff; }

.month h2{ font-size:16px; margin:4px 0 6px; text-align:center; }

/* ===== æ›œæ—¥ãƒ»æ—¥ä»˜ ===== */ .week{ display:grid; grid-template-columns:repeat(7,1fr); font-size:12px; text-align:center; margin-bottom:4px; }

.days{ display:grid; grid-template-columns:repeat(7,1fr); gap:4px; }

.day{ border:1px solid #ddd; min-height:40px; font-size:14px; display:flex; align-items:center; justify-content:center; border-radius:6px; cursor:pointer; }

/* ===== çŠ¶æ…‹è‰² ===== */ .work{background:#ffdede} .life{background:#deebff} .hobby{background:#deffe4} .none{background:#eee}

.today{ outline:3px solid #000; }

/* ===== TODO ===== */ #todoView{font-size:14px}

.todoItem{ border-bottom:1px solid #ccc; padding:8px 4px; }

.hidden{display:none} </style>

</head>
<body>
<h1>ğŸ“˜ æ‰‹å¸³</h1><div id="topbar">
  <button onclick="setView('year')">å¹´</button>
  <button onclick="setView('month')">æœˆ</button>
  <button onclick="setView('todo')">TODO</button>
</div><div id="routines">
  <button onclick="setMode('work')">ä»•äº‹</button>
  <button onclick="setMode('life')">ç§ç”¨</button>
  <button onclick="setMode('hobby')">è¶£å‘³</button>
  <button onclick="setMode('none')">ä½•ã‚‚ã—ãªã„</button>
</div><div id="calendar" class="year"></div>
<div id="todoView" class="hidden"></div><script>
// ===== çŠ¶æ…‹ =====
const calendar = document.getElementById('calendar');
const todoView = document.getElementById('todoView');

let currentView = 'year';
let viewDate = new Date();   // è¡¨ç¤ºä¸­ã®å¹´æœˆï¼ˆå”¯ä¸€ã®åŸºæº–ï¼‰
let currentMode = 'work';
const today = new Date().toISOString().slice(0,10);

// ===== åŸºæœ¬æ“ä½œ =====
function setMode(m){ currentMode = m; }
function setView(v){ currentView = v; render(); }

function prevMonth(){ viewDate.setMonth(viewDate.getMonth() - 1); render(); }
function nextMonth(){ viewDate.setMonth(viewDate.getMonth() + 1); render(); }

// ===== ä¿å­˜ =====
function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
function load(key){ return JSON.parse(localStorage.getItem(key) || '{}'); }

const marks = load('marks');
const todos = load('todos');

// ===== æç”» =====
function render(){
  calendar.innerHTML = '';
  todoView.innerHTML = '';

  calendar.className = currentView === 'year' ? 'year' : 'monthView';
  calendar.classList.toggle('hidden', currentView === 'todo');
  todoView.classList.toggle('hidden', currentView !== 'todo');

  const y = viewDate.getFullYear();
  const m0 = viewDate.getMonth(); // 0-11

  // TODOãƒ“ãƒ¥ãƒ¼
  if(currentView === 'todo'){
    Object.keys(todos).sort().forEach(d => {
      const div = document.createElement('div');
      div.className = 'todoItem';
      div.textContent = `${d}ï¼š${todos[d]}`;
      todoView.appendChild(div);
    });
    return;
  }

  // æœˆãƒ˜ãƒƒãƒ€ãƒ¼
  if(currentView === 'month'){
    const header = document.createElement('div');
    header.style.display = 'flex';
    header.style.justifyContent = 'space-between';
    header.style.alignItems = 'center';
    header.style.margin = '4px 0';
    header.innerHTML = `
      <button onclick="prevMonth()">â—€</button>
      <strong>${y}å¹´ ${m0 + 1}æœˆ</strong>
      <button onclick="nextMonth()">â–¶</button>
    `;
    calendar.appendChild(header);
  }

  const months = currentView === 'year'
    ? [...Array(12).keys()]
    : [m0];

  months.forEach(m => {
    const month = document.createElement('div');
    month.className = 'month';
    month.innerHTML = `<h2>${m + 1}æœˆ</h2>`;

    const week = document.createElement('div');
    week.className = 'week';
    ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(w => {
      week.innerHTML += `<div>${w}</div>`;
    });
    month.appendChild(week);

    const days = document.createElement('div');
    days.className = 'days';

    const first = new Date(y, m, 1).getDay();
    for(let i=0;i<first;i++) days.innerHTML += '<div></div>';

    const last = new Date(y, m+1, 0).getDate();
    for(let d=1; d<=last; d++){
      const date = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const div = document.createElement('div');
      div.className = 'day';
      if(marks[date]) div.classList.add(marks[date]);
      if(date === today) div.classList.add('today');
      div.textContent = d;
      div.onclick = () => {
        marks[date] = currentMode;
        save('marks', marks);
        const t = prompt('TODOï¼ˆç©ºã§OKï¼‰', todos[date] || '');
        if(t !== null){ t ? todos[date] = t : delete todos[date]; save('todos', todos); }
        render();
      };
      days.appendChild(div);
    }

    month.appendChild(days);
    calendar.appendChild(month);
  });
}

if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js'); }
render();
</script></body>
</html>
